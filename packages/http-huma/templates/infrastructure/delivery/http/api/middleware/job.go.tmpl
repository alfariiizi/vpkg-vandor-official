package middleware

import (
	"net/http"

	"github.com/danielgtaylor/huma/v2"
)

func NewJobMiddleware(api huma.API) func(ctx huma.Context, next func(huma.Context)) {
	return func(ctx huma.Context, next func(huma.Context)) {
		jobToken := ctx.Header("X-Job-Token")
		if jobToken == "" {
			huma.WriteErr(api, ctx, http.StatusUnauthorized, "Missing X-Job-Token header")
			return
		}

		// TODO: Validate job token
		// For now, just check if it's not empty
		if jobToken == "" {
			huma.WriteErr(api, ctx, http.StatusUnauthorized, "Invalid job token")
			return
		}

		// Save job token to context for handler use
		ctx = huma.WithValue(ctx, "job_token", jobToken)
		next(ctx)
	}
}